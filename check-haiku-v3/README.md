# check-haiku-v3

OpenAIのAPIキーを使って俳句判定をします。

## 事前準備

あらかじめ https://platform.openai.com/ のアカウントを作成し、APIプラットフォームでAPIキーを発行する必要があります。

> [!WARNING]
> APIへの問い合わせは無料ではありません。あらかじめクレジットカードを登録しCreditを購入しておく必要があります。

## 実行方法
以下のように環境変数として指定して実行します。

```sh
export OPENAI_API_KEY=<あなたのAPIキー>
php ./check-haiku-v3.php
```

標準入力から文字列を受け取るので試したい文字列を渡してください。

> [!WARNING]
> コマンドを実行するたびにOpenAIのAPIへリクエストを投げるため、Creditが消費されます。繰り返し実行する際は注意してください。


## 試した結果

### :o: 小田原でみんなで一句詠みたいな

- Expected: 俳句
- Received: 俳句

漢字を含んでいても正しくパースしてくれます。

```sh
php ./check-haiku-v3.php
小田原でみんなで一句詠みたいな
上五: 小田原で (読み: オダワラデ) (5音)
中七: みんなで一句 (読み: ミンナデイック) (7音)
下五: 詠みたいな (読み: ヨミタイナ) (5音)
合計: 17音

これは俳句です。
```

### :question: おだわらでみんなでいっくよみたいな

- Expected: 俳句
- Received: 確率的に俳句

上手く行けば俳句判定される。

```sh
php ./check-haiku-v3.php
おだわらでみんなでいっくよみたいな
上五: おだわらで (読み: オダワラデ) (5音)
中七: みんなでいっく (読み: ミンナデイック) (7音)
下五: よみたいな (読み: ヨミタイナ) (5音)
合計: 17音

これは俳句です。
```

しかし場合によっては「いっく」を2音として数え間違えることがあります。

```sh
php ./check-haiku-v3.php
おだわらでみんなでいっくよみたいな
上五: おだわらで (読み: オダワラデ) (5音)
中七: みんなでいっく (読み: ミンナデイク) (6音)
下五: よみたいな (読み: ヨミタイナ) (5音)
合計: 16音

これは俳句ではありません。
```

### :question: 十七文字の文章を作る

- Expected: Not 俳句
- Received: 確率的にパース失敗

「十七文字の文章を作る」をプロンプトだと勘違いし、17文字の文章を作ろうしたりすることもあります。

```sh
php ./check-haiku-v3.php
十七文字の文章を作る
申し訳ありませんが、そのリクエストにはお応えできません。俳句かどうかを判定するための文章を提供してください。
```

```sh
php ./check-haiku-v3.php
十七文字の文章を作る
上五: 十七文字の (読み: ジュウナナモジノ) (6音)
中七: 文章を (読み: ブンショウヲ) (5音)
下五: 作る (読み: ツクル) (3音)
合計: 14音

これは俳句ではありません。
```

### :o: 文字数的に合っててもダメだよね

- Expected: Not 俳句
- Received: Not 俳句

文章の切れ目を理解した上で5-7-5になっていないことを判定できている。

```sh
php ./check-haiku-v3.php
文字数的に合っててもダメだよね
上五: 文字数的に (読み: モジスウテキニ) (7音)
中七: 合ってても (読み: アッテテモ) (5音)
下五: ダメだよね (読み: ダメダヨネ) (5音)
合計: 17音

これは俳句ではありません。
```

### :x: 使いたいPHP判定に

- Expected: 俳句
- Received: Not 俳句

PHPの読みが安定しません。

```sh
php ./check-haiku-v3.php
使いたいPHP判定に
上五: 使いたい (読み: ツカイタイ) (5音)
中七: PHP判定に (読み: PHPハンテイニ) (8音)
下五:  (読み: ) (0音)
合計: 13音

これは俳句ではありません。
```

```sh
php ./check-haiku-v3.php
使いたいPHP判定に
上五: 使いたい (読み: ツカイタイ) (5音)
中七: PHP (読み: PHP) (3音)
下五: 判定に (読み: ハンテイニ) (4音)
合計: 12音

これは俳句ではありません。
```
